{% extends "layouts/layout.jinja2" %}
{% set is_profile_view = True if page_title else None %}

{% block content %}

  <h1 class="inline-block">
    {% if is_profile_view %}
      <a href="/groups">Group: {{ page_title }}</a>
    {% else %}
      Groups
    {% endif %}
  </h1>

  {% if is_profile_view %}
    <div class="btn close" style="float:right;" onclick="useInternalLink()">
      <a href="/groups">X</a>
    </div>
  {% endif %}


  {% for group in groups %}
    <ul id="{{ group.name }}">

      {% if not is_profile_view %}
        <li>
          <span class="field-name">Group:</span>
          <span class="field-value">
            <a href="/groups/{{ group.group }}">{{ group.group }}</a>
            {% if group.members %}
              <div class="inline-block tag yellow">
                <div class="text">{{group.members|count}}</div>
              </div>
            {% endif %}
          </span>
        </li>
      {% endif %}

      {% set profile_columns = ['created', 'updated', 'id'] %}
      {% set exclude_columns = ['group','owner_id'] %}
      {% for column in group.__table__.columns %}
        {% if column.name in exclude_columns %}{% continue %}{% endif %}
        {% if not is_profile_view and column.name in profile_columns %}{% continue %}{% endif %}
        {% set value = group[column.name] %}
        <li>
          <span class="field-name">{{ column.name | replace('_',' ') | title }}:</span>
          <span class="field-value">
            {% if column.name == 'group' %}
              <a href="/groups/{{ value }}">{{ value }}</a>
            {% else %}
              {{ value|urlize }}
            {% endif %}
          </span>
        </li>
      {% endfor %}

      {% if is_profile_view %}
      <hr>
      {#
      <li>
        <span class="field-name">Owner:</span>
        <span class="field-value">
          <a href="/users/{{group.owner.username}}">{{group.owner.username}}</a>
        </span>
      </li>
      #}
      <li class="highlight">
        <span class="field-name" >Owners:</span>
        <span class="field-value">
          {% if group.owners %}
            <ul>
              {% for owner in group.owners %}
                <li><a href="/users/{{owner.username}}">{{owner.username}}</a></li>
              {% endfor %}
            </ul>
          {% endif %}
        </span>
      </li>
      <li class="highlight">
        <span class="field-name" >Maintainers:</span>
        <span class="field-value">
          {% if group.maintainers %}
            <ul>
              {% for maintainer in group.maintainers %}
                <li><a href="/users/{{maintainer.username}}">{{maintainer.username}}</a></li>
              {% endfor %}
            </ul>
          {% endif %}
        </span>
      </li>
      <li class="highlight">
        <span class="field-name" >Members:</span>
        <span class="field-value">
          {% if group.members %}
            <ul>
              {% for member in group.members %}
                <li><a href="/users/{{member.username}}">{{member.username}}</a></li>
              {% endfor %}
            </ul>
          {% endif %}
        </span>
      </li>
      {% endif %}
    </ul>
  {% endfor %}
{% endblock %}
